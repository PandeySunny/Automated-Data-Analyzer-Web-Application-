<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analysis Results | DataInsight Analytics</title>
  <meta name="description" content="Comprehensive data analysis results with visualizations">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <a href="{{ url_for('index') }}" class="nav-brand">
        <i class="fas fa-chart-line"></i>
        <span>DataInsight Analytics</span>
      </a>
      <div class="nav-links">
        <a href="{{ url_for('index') }}#features">Features</a>
        <a href="{{ url_for('index') }}#how-it-works">How It Works</a>
        <a href="{{ url_for('upload_file') }}" class="nav-cta">New Analysis</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- Page Header -->
    <div style="text-align: center; margin: 2rem 0;">
      <h1><i class="fas fa-chart-pie"></i> Analysis Results</h1>
      <p style="color: var(--gray-600); font-size: 1.125rem;">
        Comprehensive insights from your dataset
      </p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
        <div class="stat-label">File Name</div>
        <div class="stat-value" style="font-size: 1.25rem; word-break: break-all;">{{ filename }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-table"></i></div>
        <div class="stat-label">Total Rows</div>
        <div class="stat-value">{{ "{:,}".format(rows) }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-columns"></i></div>
        <div class="stat-label">Total Columns</div>
        <div class="stat-value">{{ cols }}</div>
      </div>
    </div>

    <!-- Dataset Summary Section -->
    <h2><i class="fas fa-list-alt"></i> Dataset Summary</h2>
    <div class="table-wrapper">
      {{ summary_html | safe }}
    </div>

    <!-- Sample Rows Section -->
    <h2><i class="fas fa-eye"></i> Sample Rows</h2>
    <div class="table-wrapper">
      {{ head | safe }}
    </div>

    <!-- Visualizations Section -->
    <h2><i class="fas fa-chart-bar"></i> Visualizations</h2>
    {% if plots %}
    <div class="plots-grid">
      {% for p in plots %}
      <div class="plot-card">
        <img src="{{ p }}" alt="Data visualization chart" loading="lazy" />
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="info">
      <i class="fas fa-info-circle"></i> No visualizations were generated for this dataset.
    </div>
    {% endif %}

    <!-- AI Insights Section -->
    {% if ai_insights %}
    <h2><i class="fas fa-brain"></i> AI-Powered Insights</h2>
    
    <!-- Overall Summary -->
    {% if ai_insights.overall_summary %}
    <div class="insights-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
      <h3 style="margin-top: 0; color: white;"><i class="fas fa-lightbulb"></i> Overall Summary</h3>
      <p style="font-size: 1.1rem; line-height: 1.6;">{{ ai_insights.overall_summary }}</p>
    </div>
    {% endif %}
    
    <!-- Key Findings -->
    {% if ai_insights.key_findings %}
    <div class="insights-card" style="background: #f8f9fa; padding: 1.5rem; border-left: 4px solid #667eea; border-radius: 4px; margin-bottom: 1.5rem;">
      <h3 style="margin-top: 0; color: #333;"><i class="fas fa-checkmark-circle"></i> Key Findings</h3>
      <ul style="list-style: none; padding: 0;">
        {% for finding in ai_insights.key_findings %}
        <li style="padding: 0.5rem 0; border-bottom: 1px solid #e0e0e0;">
          <strong style="color: #667eea;">→</strong> {{ finding }}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    <!-- Anomalies & Segments -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
      <!-- Anomalies Insight -->
      {% if ai_insights.anomalies_insight %}
      <div class="insights-card" style="background: #fff3cd; padding: 1rem; border-left: 4px solid #ffc107; border-radius: 4px;">
        <h4 style="margin-top: 0; color: #856404;"><i class="fas fa-exclamation-triangle"></i> Anomaly Insights</h4>
        <p style="color: #333; margin-bottom: 0;">{{ ai_insights.anomalies_insight }}</p>
      </div>
      {% endif %}
      
      <!-- Segments Insight -->
      {% if ai_insights.segments_insight %}
      <div class="insights-card" style="background: #d4edda; padding: 1rem; border-left: 4px solid #28a745; border-radius: 4px;">
        <h4 style="margin-top: 0; color: #155724;"><i class="fas fa-sitemap"></i> Segment Insights</h4>
        <p style="color: #333; margin-bottom: 0;">{{ ai_insights.segments_insight }}</p>
      </div>
      {% endif %}
    </div>
    
    <!-- Recommendations -->
    {% if ai_insights.recommendations %}
    <div class="insights-card" style="background: #d1ecf1; padding: 1.5rem; border-left: 4px solid #17a2b8; border-radius: 4px;">
      <h3 style="margin-top: 0; color: #0c5460;"><i class="fas fa-bullseye"></i> Business Recommendations</h3>
      <ol style="padding-left: 1.5rem; color: #333;">
        {% for rec in ai_insights.recommendations %}
        <li style="padding: 0.5rem 0; line-height: 1.6;">{{ rec }}</li>
        {% endfor %}
      </ol>
    </div>
    {% endif %}
    
    <!-- Info Notice -->
    <div style="background: #e8f4f8; border-left: 4px solid #17a2b8; padding: 1rem; border-radius: 4px; margin-top: 1rem;">
      <p style="margin: 0; color: #0c5460; font-size: 0.95rem;">
        <i class="fas fa-info-circle"></i> 
        <strong>✓ Intelligent Analysis</strong> - These insights are generated using advanced data analysis algorithms (no API calls, always available)
      </p>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="back">
      <a href="{{ url_for('upload_file') }}" class="btn btn-primary btn-lg">
        <i class="fas fa-upload"></i> Upload Another File
      </a>
      <a href="{{ url_for('index') }}" class="btn btn-outline btn-lg">
        <i class="fas fa-home"></i> Back to Home
      </a>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <small>
      <i class="fas fa-lightbulb"></i> <strong>Tip:</strong> All visualizations are automatically generated based on
      your data structure<br>
      Charts are saved in <code>static/plots/</code> for your reference
    </small>
  </footer>
</body>

</html>